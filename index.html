<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>FawenYo</title><meta name="author" content="FawenYo"><meta name="copyright" content="FawenYo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="溫故而知新">
<meta property="og:type" content="website">
<meta property="og:title" content="FawenYo">
<meta property="og:url" content="https://fawenyo.ml/index.html">
<meta property="og:site_name" content="FawenYo">
<meta property="og:description" content="溫故而知新">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://fawenyo.ml/img/logo.png">
<meta property="article:author" content="FawenYo">
<meta property="article:tag" content="生活、技術、前端、後端、Python、人工智慧、Database">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fawenyo.ml/img/logo.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://fawenyo.ml/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-Q9N2VM12ST"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-Q9N2VM12ST');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"KEUSKU2D0E","apiKey":"58fed9484064df2012f18c844818c14c","indexName":"FawenYo_Hexo","hits":{"per_page":6},"languages":{"input_placeholder":"搜尋文章","hits_empty":"找不到您查詢的內容：${query}","hits_stats":"找到 ${hits} 條結果，用時 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '複製成功',
    error: '複製錯誤',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'FawenYo',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-12-04 22:41:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/logo.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">10</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/tags/Python/"><i class="fa-fw fab fa-python"></i><span> Python</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 總覽</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">FawenYo</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜尋</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/tags/Python/"><i class="fa-fw fab fa-python"></i><span> Python</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 總覽</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">FawenYo</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/FawenYo" target="_blank" title="Github" rel="external nofollow noopener noreferrer"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:sky80838@gmail.com" target="_blank" title="Email" rel="external nofollow noopener noreferrer"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.linkedin.com/in/%E9%88%9E%E7%80%9A-%E9%84%AD-603464205/" target="_blank" title="LinkedIn" rel="external nofollow noopener noreferrer"><i class="fab fa-linkedin-in"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/K8S_migration_record/" title="K8S 遷移記錄"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/kubernetes.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S 遷移記錄"></a></div><div class="recent-post-info"><a class="article-title" href="/K8S_migration_record/" title="K8S 遷移記錄">K8S 遷移記錄</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2022-12-04T07:13:25.000Z" title="發表於 2022-12-04 15:13:25">2022-12-04</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Kubernetes/">Kubernetes</a></span></div><div class="content">前言
前陣子因為太忙，一直沒空處理 Side Project 的內容
前幾天原本在跑的 LINE Bot 伺服器突然就掛掉不動了，才想起來前陣子 Heroku 免費的服務要結束了 (Reference: Heroku’s Next Chapter | Heroku)，原本放在上面跑的服務瞬間成了孤兒得找個新家
剛好最近工作上有機會能接觸到 Kubernetes，就想趁這個機會把原本的服務搬到 Kubernetes 上面，而這篇文章也是紀錄一下遷移的過程
需求
首先要先了解一下原本的服務需求，這個小 side project 包含了：

Python 運行環境，用來處理 LINE Bot 和作為 API Server
Redis，其中程式會用到 Redis 來做資料的暫存
Cron Job，用來定時執行程式

Python 的部分當初就是使用 Heroku PaaS 的服務，而 Redis 當初則是使用 Redis Enterprise Cloud – Fully Managed Cloud Service | Redis
另外也有在 cron-job.org 上設定 Cron Job  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/m1_tensorflow_install/" title="Apple M1 Tensorflow 安裝"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/Tensorflow.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Apple M1 Tensorflow 安裝"></a></div><div class="recent-post-info"><a class="article-title" href="/m1_tensorflow_install/" title="Apple M1 Tensorflow 安裝">Apple M1 Tensorflow 安裝</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2022-02-06T01:55:47.000Z" title="發表於 2022-02-06 09:55:47">2022-02-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Python/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/">人工智慧</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/">人工智慧</a></span></div><div class="content">起源
前陣子因為舊筆電的電池續航完全崩盤，再加上零零總總的小問題，加上零零總總的小問題，因緣際會下入手了 Apple Macbook Air M1 筆電。
然而最近在訓練模型 (Tensorflow, PyTorch, XGBoost) 的時候，發現同樣的模型架構在 M1 和 Google Colab 上的運行結果卻天差地遠
(註：同樣的 Tensorflow 模型在 M1 上的結果相較 Google Colab 差上許多，但有趣的是 XGBoost 的情況卻剛好相反)。
本篇文章主要是在記錄問題觀察和解決過程。
問題觀察
猜測 1: Python 套件版本不同
剛開始懷疑是 Python 套件版本不同導致結果出現差異。
在本機端簡單列出套件版本後在 Google Colab 上執行
1!pip3 install &#123;package&#125;==&#123;version&#125;
但結果卻沒有差很多，顯然套件版本並不是本次問題的主要原因。
猜測 2: CPU 與 GPU 計算結果差異
當時也考慮過可能是 CPU 和 GPU 造成的結果差異。
在 Google Colab  ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/line_bot_fastapi/" title="LINE Bot FastAPI 教學"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/LINE_Bot_FastAPI.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LINE Bot FastAPI 教學"></a></div><div class="recent-post-info"><a class="article-title" href="/line_bot_fastapi/" title="LINE Bot FastAPI 教學">LINE Bot FastAPI 教學</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2021-08-13T12:19:50.000Z" title="發表於 2021-08-13 20:19:50">2021-08-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/">教學</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/">Python</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/FastAPI/">FastAPI</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/FastAPI/LINE-Bot/">LINE Bot</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Python/">Python</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/LINE-Bot/">LINE Bot</a></span></div><div class="content">鑑於網路上目前大部分 Python LINE Bot 教學多半使用 Flask 框架作為範例，但由於 FastAPI 非同步特性的優勢，目前趨勢已經開始從 Flask 往 FastAPI 移動。
本篇文章主要面向新手教學，使用 Python FastAPI 框架為範例，帶領大家做出自己的第一個 LINE Bot。
目標

用 Python FastAPI 建立自己的第一個 echo bot (回聲機器人，Bot 接收到使用者訊息後會回傳一樣的內容給使用者)
寫完程式碼後，將程式部署至 Heroku (免費) 或 自有主機 (可參考各大 VPS 主機商費用) 上架設伺服器並運行服務
釐清 LINE Bot 中 reply 和 push 機制的差別

教學開始
Step 1. 建立 LINE Bot

進入 LINE 控制台 並輸入 LINE 帳號密碼登入

創建服務提供者

輸入提供者名稱後，點擊 Create

選擇創建 Messaging API

填入 LINE Bot 必要資訊，最後勾選同意條款，選擇 Create 創建機器人


至此，我們已經創建好了 LINE Bot，但它目 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/bert_note/" title="BERT 筆記"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/BERT.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BERT 筆記"></a></div><div class="recent-post-info"><a class="article-title" href="/bert_note/" title="BERT 筆記">BERT 筆記</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2021-08-07T14:42:07.000Z" title="發表於 2021-08-07 22:42:07">2021-08-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E7%AD%86%E8%A8%98/">筆記</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E7%AD%86%E8%A8%98/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/">人工智慧</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/">人工智慧</a></span></div><div class="content">
Cover image source： BERT: how Google changed NLP (and how to benefit from this)

本篇文章假設已經對 Self-attention 和 Transformer 模型有基本概念，若還不熟悉可以先閱讀前篇 Self-attention &amp; Transformer 筆記
本篇筆記是參考 台大李宏毅老師 【機器學習 2021】自督導式學習 (Self-supervised Learning) (一) – 芝麻街與進擊的巨人 、 【機器學習 2021】自督導式學習 (Self-supervised Learning) (二) – BERT 簡介 上課內容
BERT 是什麼

BERT 全名是 Bidirectional Encoder Representations from Transformers，其架構就是 Transformer 的 Encoder
訓練任務：
訓練任務分為兩種：克漏字填空 (Masking Input) 與 預測下一個句子 (Next Sentence Prediction)

克 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/self-attention_transformer_note/" title="Self-attention &amp; Transformer 筆記"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/Transformer.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Self-attention &amp; Transformer 筆記"></a></div><div class="recent-post-info"><a class="article-title" href="/self-attention_transformer_note/" title="Self-attention &amp; Transformer 筆記">Self-attention &amp; Transformer 筆記</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2021-08-06T20:30:35.000Z" title="發表於 2021-08-07 04:30:35">2021-08-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E7%AD%86%E8%A8%98/">筆記</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E7%AD%86%E8%A8%98/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/">人工智慧</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/">人工智慧</a></span></div><div class="content">筆記內容是參考 台大李宏毅老師 【機器學習 2021】自注意力機制 (Self-attention) (上) 、 【機器學習 2021】自注意力機制 (Self-attention) (下) 、 【機器學習 2021】Transformer (上) 和 【機器學習 2021】Transformer (下) 課程內容
Self-attention
為何需要 Self-attention ?


過去 CNN 是輸入單一向量 (vector)，但有些情況 (ex. 語意識別、語音辨識) 輸入可能是不固定長度的向量集合 (set of vectors)



Q: One-hot Encoding 為何不適合用來處理文字？
A: 使用 One-hot Encoding 會導致各個詞彙間沒有關係，可使用 Word Embedding 方式處理



Self-attention 的輸出可以是與輸入長度相同的結果，也可以是一個 label，也可以是長度不固定的 sequence



什麼是 Self-attention ?
架構



其中 Self-attention 層是可以重複出現的，即 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/hexo_butterfly_calendar/" title="Hexo Butterfly: 文章日曆"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/Hexo_butterfly_calendar.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo Butterfly: 文章日曆"></a></div><div class="recent-post-info"><a class="article-title" href="/hexo_butterfly_calendar/" title="Hexo Butterfly: 文章日曆">Hexo Butterfly: 文章日曆</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2021-07-24T08:32:13.000Z" title="發表於 2021-07-24 16:32:13">2021-07-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/">教學</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Hexo/">Hexo</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Hexo/">Hexo</a></span></div><div class="content">前言
一開始是看到網路上一位名為 ouoholly 的 教學文章，看著覺得效果不錯便也想跟著修改，不過似乎是因為 Butterfly 3.0 大改版的關係，原文章的修改方法會一直出問題。 本文章為紀錄 3.0 改版後 (當前示範版本: 3.8.1) 要如何在 Butterfly 主題中的側邊欄位上加入日曆插件。
成果圖
日曆的介面基本和 ouoholly 的內容是一樣的，感謝原文章分享！

操作步驟
1. 安裝 Hexo generator calendar
原文中的 hexo-generator-calendar 似乎沒辦法用了 (測試 Butterfly 版本: 3.8.1)，上網搜尋後改使用 howiefh 的 hexo-generator-calendar
1npm install --save git://github.com/howiefh/hexo-generator-calendar.git
2. 設定 hexo-generator-calendar
於 Hexo _config.yml (root) 中添加設定
123calendar:  single: true   ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/python_loguru/" title="更優雅的 Python Log - Loguru"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/Loguru_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="更優雅的 Python Log - Loguru"></a></div><div class="recent-post-info"><a class="article-title" href="/python_loguru/" title="更優雅的 Python Log - Loguru">更優雅的 Python Log - Loguru</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2021-07-24T03:01:22.000Z" title="發表於 2021-07-24 11:01:22">2021-07-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/">教學</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/">Python</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Python/">Python</a></span></div><div class="content">前言
剛開始自學程式的時候，總想著用 print 大法一招打天下 (謎之聲：簡單方便又能用，跟 log 比起來不香嗎((誤
一直到最近幾次做有一定規模的專案時，才深刻理解到 print 的不足：很難被 traceback。 舉例而言，當用戶遇到 bug 的時候，埋 print 的情況就必須慢慢逐一檢查所有 print 的訊息，像是大海撈針一般，好不容易找到 print error 後還要再花上大半時間解 bug；相反地，若是使用 log 做記錄，我們可以快速篩選出發生的錯誤訊息，大幅降低定位 bug 所需的時間與精力，甚至是某些紀錄我們希望能被紀錄起來待日後進行其他運用，這些都是 print 所沒辦法達到的好處。
雖然 log 聽起來很好用， Python3 也有內建 logging 函式庫，但就新手的角度而言 log 是非常麻煩的作業且具有一定門檻 - handler, formatter, filter… 這讓很多人最後還是回頭用 print。 而我們今天要介紹的 Loguru 便是主打著 Python logging made (stupidly) simple 的名號，號稱簡單 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/mongodb_search_nearby/" title="MongoDB 搜尋附近資料"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/Mongo_nearby.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MongoDB 搜尋附近資料"></a></div><div class="recent-post-info"><a class="article-title" href="/mongodb_search_nearby/" title="MongoDB 搜尋附近資料">MongoDB 搜尋附近資料</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2021-07-24T01:05:53.000Z" title="發表於 2021-07-24 09:05:53">2021-07-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/">教學</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/">Python</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/MongoDB/">MongoDB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Python/">Python</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/MongoDB/">MongoDB</a></span></div><div class="content">前言
某些 APP 中會有類似 “搜尋附近景點” 的功能需求，需要在資料中搜尋位於某一座標點若干距離內的資料，將整個資料庫數據 dump 出並分別計算距離的方法並不實際且效率很差，此時我們便可以利用 MongoDB 內建的 地理位置索引 功能實現。
資料庫結構
我們的資料結構大致如圖 
其中 loc 的結構為 [loc, lat]。
搜尋方法
這邊我們使用 Python 作為示範教學，搜尋座標點附近 500 公尺 內的資料。 其中 db 已於 config.py 中先完成初始化，您亦可刪除程式碼中與 config 有關的內容並在函式執行前先行初始化 db。
123456789101112131415161718192021222324252627282930313233343536373839404142import config # Self-created for initializing db. You can also ignore it and implement yours.from bson.son import SONfrom pymongo import GEOSPH ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/mongodb_basic/" title="MongoDB - 基礎"><img class="post_bg" src= "/img/loading.gif" data-lazy-src="/images/Mongo_logo_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MongoDB - 基礎"></a></div><div class="recent-post-info"><a class="article-title" href="/mongodb_basic/" title="MongoDB - 基礎">MongoDB - 基礎</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">發表於</span><time datetime="2021-07-18T07:45:35.000Z" title="發表於 2021-07-18 15:45:35">2021-07-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/">教學</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/">Python</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%95%99%E5%AD%B8/Python/MongoDB/">MongoDB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Python/">Python</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/MongoDB/">MongoDB</a></span></div><div class="content">註冊
如有私有伺服器可參考官網架設教學，這邊使用官方免費的 MongoDB Atlas 作範例

註冊 MongoDB Atlas

選擇 Shared 免費資料庫方案

選擇 資料庫位置，這邊以 Google Cloud 在台灣之伺服器作為示範
選擇完點選建立
完成註冊後等待約 3 分鐘建立 server 即可開始使用
取得連線連接

點選 CONNECT

設定連接資訊
因環境 IP 不固定，測試階段可先開啟所有 IP
選擇 Allow Access from Anywhere 接受所有連線
底下的 Username 以及 Password 自行設定後點擊 Create Database User 並點擊 Choose a connection method 按鈕

選擇 Connect your application

選擇 Python 3.6 就可以取得 Connection String 囉~




Python 操作
安裝 pymongo
12pip install pymongo[srv]# 若安裝過程出現問題，可以改使用 pip install &quot;pym ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">FawenYo</div><div class="author-info__description">溫故而知新</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/FawenYo"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/FawenYo" target="_blank" title="Github" rel="external nofollow noopener noreferrer"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:sky80838@gmail.com" target="_blank" title="Email" rel="external nofollow noopener noreferrer"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.linkedin.com/in/%E9%88%9E%E7%80%9A-%E9%84%AD-603464205/" target="_blank" title="LinkedIn" rel="external nofollow noopener noreferrer"><i class="fab fa-linkedin-in"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-calendar"><div class="card-content"><div class="item-headline"><i class="fa fa-calendar" aria-hidden="true"></i><span>文章日曆</span></div><div class="widget-wrap"></div><div class="widget" id="calendar"></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/K8S_migration_record/" title="K8S 遷移記錄"><img src= "/img/loading.gif" data-lazy-src="/images/kubernetes.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S 遷移記錄"></a><div class="content"><a class="title" href="/K8S_migration_record/" title="K8S 遷移記錄">K8S 遷移記錄</a><time datetime="2022-12-04T07:13:25.000Z" title="發表於 2022-12-04 15:13:25">2022-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/m1_tensorflow_install/" title="Apple M1 Tensorflow 安裝"><img src= "/img/loading.gif" data-lazy-src="/images/Tensorflow.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Apple M1 Tensorflow 安裝"></a><div class="content"><a class="title" href="/m1_tensorflow_install/" title="Apple M1 Tensorflow 安裝">Apple M1 Tensorflow 安裝</a><time datetime="2022-02-06T01:55:47.000Z" title="發表於 2022-02-06 09:55:47">2022-02-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/line_bot_fastapi/" title="LINE Bot FastAPI 教學"><img src= "/img/loading.gif" data-lazy-src="/images/LINE_Bot_FastAPI.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LINE Bot FastAPI 教學"></a><div class="content"><a class="title" href="/line_bot_fastapi/" title="LINE Bot FastAPI 教學">LINE Bot FastAPI 教學</a><time datetime="2021-08-13T12:19:50.000Z" title="發表於 2021-08-13 20:19:50">2021-08-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/bert_note/" title="BERT 筆記"><img src= "/img/loading.gif" data-lazy-src="/images/BERT.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BERT 筆記"></a><div class="content"><a class="title" href="/bert_note/" title="BERT 筆記">BERT 筆記</a><time datetime="2021-08-07T14:42:07.000Z" title="發表於 2021-08-07 22:42:07">2021-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/self-attention_transformer_note/" title="Self-attention &amp; Transformer 筆記"><img src= "/img/loading.gif" data-lazy-src="/images/Transformer.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Self-attention &amp; Transformer 筆記"></a><div class="content"><a class="title" href="/self-attention_transformer_note/" title="Self-attention &amp; Transformer 筆記">Self-attention &amp; Transformer 筆記</a><time datetime="2021-08-06T20:30:35.000Z" title="發表於 2021-08-07 04:30:35">2021-08-07</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分類</span>
            <a class="card-more-btn" href="/categories/" title="檢視更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Python/"><span class="card-category-list-name">Python</span><span class="card-category-list-count">1</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Python/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/"><span class="card-category-list-name">人工智慧</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%99%E5%AD%B8/"><span class="card-category-list-name">教學</span><span class="card-category-list-count">5</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%99%E5%AD%B8/Hexo/"><span class="card-category-list-name">Hexo</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%99%E5%AD%B8/Python/"><span class="card-category-list-name">Python</span><span class="card-category-list-count">4</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%99%E5%AD%B8/Python/FastAPI/"><span class="card-category-list-name">FastAPI</span><span class="card-category-list-count">1</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%99%E5%AD%B8/Python/FastAPI/LINE-Bot/"><span class="card-category-list-name">LINE Bot</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%99%E5%AD%B8/Python/MongoDB/"><span class="card-category-list-name">MongoDB</span><span class="card-category-list-count">2</span></a></li></ul></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>標籤</span></div><div class="card-tag-cloud"><a href="/tags/Hexo/" style="font-size: 1.1em; color: #999">Hexo</a> <a href="/tags/Kubernetes/" style="font-size: 1.1em; color: #999">Kubernetes</a> <a href="/tags/LINE-Bot/" style="font-size: 1.1em; color: #999">LINE Bot</a> <a href="/tags/MongoDB/" style="font-size: 1.23em; color: #999ea6">MongoDB</a> <a href="/tags/Python/" style="font-size: 1.5em; color: #99a9bf">Python</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7/" style="font-size: 1.37em; color: #99a4b2">人工智慧</a> <a href="/tags/%E6%95%99%E5%AD%B8/" style="font-size: 1.1em; color: #999">教學</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>歸檔</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">八月 2021</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/07/"><span class="card-archive-list-date">七月 2021</span><span class="card-archive-list-count">4</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>網站資訊</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章數目 :</div><div class="item-count">9</div></div><div class="webinfo-item"><div class="item-name">本站總字數 :</div><div class="item-count">10k</div></div><div class="webinfo-item"><div class="item-name">本站訪客數 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站總訪問量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最後更新時間 :</div><div class="item-count" id="last-push-date" data-lastpushdate="2022-12-04T14:41:43.012Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By FawenYo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主題 </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="淺色和深色模式轉換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到頂部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜尋</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: "溫故而知新",
      startDelay: 300,
      typeSpeed: 150,
      loop: false,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '溫'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="true" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>